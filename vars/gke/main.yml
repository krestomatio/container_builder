repo_owner: "{{ lookup('env','REPO_OWNER') | default('krestomatio',true) }}"
repo_name: "{{ lookup('env','REPO_NAME') | default('container_builder',true) }}"
project_org: "{{ lookup('env','DOCKER_REGISTRY_ORG') | default('',true) }}"
project_registry_path: "{{ project_org + '/' if project_org }}{{ repo_owner+'/'+repo_name }}"
build_number: "{{ lookup('env','BUILD_NUMBER') | default(ansible_date_time.epoch,true) }}"
build_version: "{{ lookup('env','VERSION') | default('',true) }}"
build_cache: true
build_cache_prepull: true
build_cache_first_prepull: true
build_push: "{{ lookup('env','BUILD_PUSH') | default(true,true) }}"
build_cache_from_tag_list:
  - "{{ build_version }}"
  - "{{ lookup('env','PREVIEW_VERSION') }}"
  - latest
build_add_minor_major_cache_tags: "{{ lookup('env','BUILD_CACHE_ADD_MINOR_MAJOR_TAGS') | default(true,true) }}"
build_tag_list:
  - "{{ build_version }}"
build_add_minor_major_tags: "{{ lookup('env','BUILD_ADD_MINOR_MAJOR_TAGS') | default(false,true) }}"
builder_config: "{{ lookup('env','BUILDER_CONFIG') | default(true,true) }}"

# registry
build_registry_name: "{{ lookup('env','BUILD_REGISTRY_NAME') | default('gcr.io',true) }}"
cache_registry_name: "{{ lookup('env','CACHE_REGISTRY_NAME') | default('gcr.io',true) }}"
cache_registry_path: "{{ lookup('env','CACHE_REGISTRY_PATH') | default(cache_registry_name + '/' + project_registry_path,true) }}"
build_registry_path: "{{ lookup('env','BUILD_REGISTRY_PATH') | default(build_registry_name + '/' + project_registry_path,true) }}"

# dockerfile_builder
dockerfile_builder: "{{ lookup('env','DOCKERFILE_BUILDER') | default('docker',true) }}"
dockerfile_builder_validate_certs: "{{ lookup('env','VALIDATE_CERTS') | default(true,true) }}"
build_cache_from_tags: "{{ lookup('env','BUILD_CACHE_FROM_TAGS') | default(build_cache_from_tag_list,true) }}"
dockerfile_builder_tags: "{{ lookup('env','BUILD_TAGS') | default(build_tag_list,true) }}"
dockerfile_builder_image_from_tag: "{{ lookup('env','BUILD_FROM_TAG') | default(false,true) }}"
dockerfile_builder_username: "{{ lookup('env','REGISTRY_USERNAME') | default('',true) }}"
dockerfile_builder_password: "{{ lookup('env','REGISTRY_PASSWORD') | default('',true) }}"
dockerfile_builder_image_version: "{{ lookup('env','IMAGE_VERSION') | default(build_version | regex_search('\\d+(\\.\\d+){2,}'),true) }}"
dockerfile_builder_force_source_on_changed: false

# centos8-minimal
centos8_omit_rootfs_creation: "{{ lookup('env','CENTOS8_OMIT_ROOTFS') | default(true,true) }}"

# docker
docker_start_daemon: true
docker_config_json: "{{ lookup('env','DOCKER_CONFIG_JSON') | default('omit',true) }}"
docker_config_json_path: /tekton/home/.docker/config.json

# podman
podman_conf_dir: "/etc/containers"
storage_graphroot: "{{ lookup('env','STORAGE_CONTAINER_PATH') | default('/workspace/containers/storage',true) }}"
storage_driver: "{{ lookup('env','STORAGE_DRIVER') | default('overlay',true) }}"
registry_unqualified: "{{ lookup('env','REGISTRY_UNQUALIFIED') | default(\"'\" + registry_name + \"'\",true) }}"
registry_location: "{{ lookup('env','REGISTRY_LOCATION') | default(registry_name,true) }}"
