buildPack: none
pipelineConfig:
  env:
  - name: CLOUD_PROVIDER
    value: gke
  pipelines:
    pullRequest:
      pipeline:
        options:
          timeout:
            time: 60
            unit: minutes
        stages:
        - name: build
          agent:
            image: krestomatio/ansible-docker-ci
          env:
          - name: DOCKER_CONFIG_JSON
            valueFrom:
              secretKeyRef:
                name: jenkins-docker-cfg
                key: config.json
          options:
            containerOptions:
              securityContext:
                privileged: true
          steps:
          - name: update submodules
            command: git submodule update --init --recursive
          - name: build containers
            command: ansible-playbook -i inventory/hosts build.yml
