buildPack: none
noReleasePrepare: true
pipelineConfig:
  env:
  - name: CLOUD_PROVIDER
    value: m6e
  pipelines:
    pullRequest:
      pipeline:
        options:
          containerOptions:
            securityContext:
              privileged: true
          timeout:
            time: 60
            unit: minutes
        stages:
        - name: build
          agent:
            image: krestomatio/ansible-docker-ci
          steps:
          # - name: fetch tags
          #   command: git fetch --tag
          # - name: update submodules
          #   command: git submodule update --init --recursive
          - name: build containers
            command: git rev-parse HEAD # ansible-playbook -i inventory/hosts build.yml
    release:
      # setVersion:
      #   steps:
      #     - name: next-version
      #       sh: "sleep 60; echo '' > ./VERSION"
      # build:
      #   replace: true
      #   steps:
      #   - name: fetch tags
      #     command: git fetch --tag; sleep 180
      #   - name: update submodules
      #     command: git submodule update --init --recursive
      #   - name: release
      #     command: ansible-playbook -i inventory/hosts release.yml
      pipeline:
        options:
          timeout:
            time: 60
            unit: minutes
        stages:
        - name: release
          agent:
            image: krestomatio/ansible-docker-ci
          steps:
          # - name: fetch tags
          #   command: git fetch --tag
          # - name: update submodules
          #   command: git submodule update --init --recursive
          - name: release
            command: sleep 900 # ansible-playbook -i inventory/hosts release.yml
