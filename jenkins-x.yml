buildPack: none
noReleasePrepare: true
pipelineConfig:
  env:
  - name: CLOUD_PROVIDER
    value: m6e
  pipelines:
    pullRequest:
      pipeline:
        options:
          containerOptions:
            securityContext:
              privileged: true
          timeout:
            time: 60
            unit: minutes
        stages:
        - name: build
          agent:
            image: krestomatio/ansible-docker-ci
          steps:
          - name: fetch tags
            command: git fetch --tag
          - name: update submodules
            command: git submodule update --init --recursive
          - name: build containers
            command: ansible-playbook -i inventory/hosts build.yml
    release:
      pipeline:
        options:
          timeout:
            time: 60
            unit: minutes
        stages:
        - name: release
          agent:
            image: krestomatio/ansible-docker-ci
          steps:
          - name: fetch tags
            command: git fetch --tag
          - name: update submodules
            command: git submodule update --init --recursive
          - name: promote
            command: sleep 900 # ansible-playbook -i inventory/hosts release.yml
