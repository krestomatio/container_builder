#!/bin/bash -e
# description: base config for moodle

# install all locales and timezones
locale-tz-all

# install moodle dependencies
install-pkgs ${MOODLE_INSTALL_PHP_PKGS}

# In order to drop the root user, make some directories world
# writeable as OpenShift default security model is to run the container under
# random UID.

mkdir -p ${MOODLE_APP} ${MOODLE_DATA} ${MOODLE_CLI_TOOLS}

# dir for optional entrypoint scripts
mkdir -p ${CTR_ENTRYPOINT_OPT_PATH}

fix-permissions -u ${CTR_USER_ID} ${MOODLE_APP} ${MOODLE_DATA} ${MOODLE_CLI_TOOLS}

# enable redis and igbinary php modules
if [ -f /usr/lib64/php/modules/redis.so ] && [ ! -f /etc/php.d/50-redis.ini ]; then
    echo "extension = redis.so" > /etc/php.d/50-redis.ini
fi
if [ -f /usr/lib64/php/modules/igbinary.so ] && [ ! -f /etc/php.d/40-igbinary.ini ]; then
    echo "extension = igbinary.so" > /etc/php.d/40-igbinary.ini;
fi
